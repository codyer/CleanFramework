package com.cody.handler.business.viewmodel;import android.databinding.ObservableBoolean;import android.databinding.ObservableField;import android.databinding.ObservableInt;import com.cody.handler.framework.viewmodel.ListWithHeaderViewModel;import com.cody.repository.business.bean.SendCouponBean;import com.cody.repository.business.local.LocalKey;import com.cody.repository.framework.Repository;import com.cody.xf.utils.LogUtil;import java.util.ArrayList;import java.util.List;/** * Created by chen.huarong on 2018/8/16. * 潜在客户页面 */public class PotentialCustomerViewModel extends ListWithHeaderViewModel<ItemPotentialCustomerViewModel> {    public static final int FILTER_TYPE_ALL = 0;    public static final int FILTER_TYPE_BROWER_SHOP = 1;    public static final int FILTER_TYPE_BROWER_GOOD = 2;    private final ObservableBoolean mTotalCheck = new ObservableBoolean(false);//全选    private final ObservableBoolean mUncouponCheck = new ObservableBoolean(false);//未发券    private final ObservableBoolean mIsSendCoupons = new ObservableBoolean(false);//是否是发券状态    private final ObservableInt mFilterType = new ObservableInt(FILTER_TYPE_ALL);//筛选类型    private final ObservableField<String> mConfirmBtnText = new ObservableField<>("确认");    private int totalCount;//总人数    private ObservableInt checkCount = new ObservableInt(0);//选中人数    public ObservableBoolean getTotalCheck() {        return mTotalCheck;    }    public void setTotalCheck(boolean value) {        mTotalCheck.set(value);    }    public ObservableBoolean getUncouponCheck() {        return mUncouponCheck;    }    public void setUncouponCheck(boolean value) {        mUncouponCheck.set(value);    }    public ObservableBoolean getIsSendCoupons() {        return mIsSendCoupons;    }    public void setIsSendCoupons(boolean value) {        mIsSendCoupons.set(value);    }    public void toggleIsSendCoupons() {        mIsSendCoupons.set(!mIsSendCoupons.get());        if (mIsSendCoupons.get()) {            getHeaderViewModel().setRightText("取消");        } else {            getHeaderViewModel().setRightText("发券");        }    }    public ObservableInt getFilterType() {        return mFilterType;    }    public void setFilterType(int type) {        mFilterType.set(type);    }    public ObservableField<String> getConfirmBtnText() {        return mConfirmBtnText;    }    public int getTotalCount() {        return totalCount;    }    public void setTotalCount(int totalCount) {        this.totalCount = totalCount;    }    public void setCheckCount(int checkCount) {        this.checkCount.set(checkCount);        //设置选中人数的时候需要修改确认按钮的文案        if (checkCount == 0) {            this.mConfirmBtnText.set("确认");//            mTotalCheck.set(false);//            mUncouponCheck.set(false);        } else {            this.mConfirmBtnText.set(String.format("确认(%d)", checkCount));        }    }    public ObservableInt getCheckCount() {        return checkCount;    }    public void addCheckCount() {        if (checkCount.get() < totalCount) {            setCheckCount(checkCount.get() + 1);        }    }    public void subtractCheckCount() {        if (checkCount.get() > 0) {            setCheckCount(checkCount.get() - 1);        }    }    /**     * 获取过滤字段     *     * @return     */    public String getQueryField() {        String queryField = String.format("shopId:%s;type:1", Repository.getLocalValue(LocalKey.SHOP_ID));        switch (mFilterType.get()) {            case FILTER_TYPE_BROWER_SHOP:                queryField += ";scanShopFlag:1";                break;            case FILTER_TYPE_BROWER_GOOD:                queryField += ";scanGoodsFlag:1";                break;        }        if (mUncouponCheck.get()) {//选中未领券            queryField += ";sendCouponCount:0";        }        LogUtil.d("queryField=" + queryField);        return queryField;    }    /**     * 给接口的客户列表有两种（选中全选或者未发券时返回未选中客户列表，其他情况返回选中客户列表或者）     *     * @return     */    public List<SendCouponBean.UserListBean> getUserListBean() {        List<SendCouponBean.UserListBean> userListBeans = new ArrayList<>();        for (ItemPotentialCustomerViewModel itemLatentCustomerViewModel : this) {            if (mUncouponCheck.get() || mTotalCheck.get()) {//返回未选中的客户                if (!itemLatentCustomerViewModel.getCheck().get()) {//未选中                    SendCouponBean.UserListBean userListBean = new SendCouponBean.UserListBean();                    userListBean.setUserOpenId(itemLatentCustomerViewModel.getOpenId());                    userListBeans.add(userListBean);                }            } else {                if (itemLatentCustomerViewModel.getCheck().get()) {//选中                    SendCouponBean.UserListBean userListBean = new SendCouponBean.UserListBean();                    userListBean.setUserOpenId(itemLatentCustomerViewModel.getOpenId());                    userListBeans.add(userListBean);                }            }        }        return userListBeans;    }}